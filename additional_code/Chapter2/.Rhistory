aDMPs_with_CCC$Direction <- ifelse(aDMPs_with_CCC$pval>=thr, 'No change', ifelse(
aDMPs_with_CCC$beta>0, 'Hypermethylated', 'Hypomethylated'));
aDMPs_with_CCC$shape <- NA;
aDMPs_with_CCC$shape[aDMPs_with_CCC$ProbeID %in% horvath_sites$CpGmarker] <- 'In Horvath model';
aDMPs_without_CCC <- aDMPs_without_CCC[order(as.numeric(aDMPs_without_CCC$pval), -as.numeric(abs(aDMPs_without_CCC$t))),];
aDMPs_without_CCC$Direction <- ifelse(aDMPs_without_CCC$pval>=thr, 'No change', ifelse(
aDMPs_without_CCC$beta>0, 'Hypermethylated', 'Hypomethylated'));
aDMPs_without_CCC$shape <- NA;
aDMPs_without_CCC$shape[aDMPs_without_CCC$ProbeID %in% horvath_sites$CpGmarker] <- 'In Horvath model';
aDMPs_with_CCC$Direction
table(aDMPs_with_CCC$Direction)
median(aDMPs_with_CCC$beta[aDMPs_with_CCC$Direction=='Hypomethylated'])
median(aDMPs_with_CCC$beta[aDMPs_with_CCC$Direction=='Hypermethylated'])
median(aDMPs_with_CCC$beta[aDMPs_with_CCC$Direction=='No change'])
median(aDMPs_without_CCC$beta[aDMPs_without_CCC$Direction=='Hypomethylated'])
median(aDMPs_without_CCC$beta[aDMPs_without_CCC$Direction=='Hypermethylated'])
median(aDMPs_without_CCC$beta[aDMPs_without_CCC$Direction=='No change'])
table(aDMPs_with_CCC$shape[aDMPs_with_CCC$Direction!='No change'])
table(aDMPs_without_CCC$shape[aDMPs_without_CCC$Direction!='No change'])
188/353
190/353
table(aDMPs_with_CCC$slope[aDMPs_with_CCC$Direction=='Hypermethylated'])
table(aDMPs_with_CCC$slope[aDMPs_with_CCC$Direction=='Hypomethylated'])
table(aDMPs_with_CCC$shape[aDMPs_with_CCC$Direction=='Hypermethylated'])
table(aDMPs_with_CCC$shape[aDMPs_with_CCC$Direction=='Hypomethylated'])
table(aDMPs_without_CCC$shape[aDMPs_without_CCC$Direction=='Hypomethylated'])
table(aDMPs_without_CCC$shape[aDMPs_without_CCC$Direction=='Hypermethylated'])
2,121/16
2121/16
99466/321565
99466/429296
setwd('/Users/dem44/Documents/Thesis/PhD-Thesis/additional_code/Chapter2/');
library(data.table);
library(ggplot2);
library(flexmix);
library(RColorBrewer);
library(gridExtra);
library(cowplot);
library(IlluminaHumanMethylation450kanno.ilmn12.hg19);
library(ggthemes);
#### 1. Basic description of the control dataset. ####
raw_controls <- as.data.frame(fread('final_control_data.tsv'));
horvath_control_scatterplot <- ggplot(data=raw_controls, aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2);
horvath_control_scatterplot
horvath_control_scatterplot <- ggplot(data=raw_controls, aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='black', fill='darkgrey');
horvath_control_scatterplot
horvath_control_scatterplot <- ggplot(data=raw_controls[raw_controls$Age_years <= 55,], aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='black', fill='darkgrey');
horvath_control_scatterplot
horvath_control_scatterplot_half <- ggplot(data=raw_controls[raw_controls$Age_years <= 55,], aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,60)) + ylim(c(-1,60)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='black', fill='darkgrey');
horvath_control_scatterplot_half
horvath_control_scatterplot_half <- ggplot(data=raw_controls[raw_controls$Age_years <= 55,], aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,70)) + ylim(c(-1,70)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='black', fill='darkgrey');
horvath_control_scatterplot_half
horvath_control_scatterplot_half <- ggplot(data=raw_controls[raw_controls$Age_years <= 55,], aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='black', fill='darkgrey');
horvath_control_scatterplot_half
horvath_control_scatterplot <- ggplot(data=raw_controls, aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='black', fill='darkgrey') +
labs(title =paste0("N = ", nrow(raw_controls)));
horvath_control_scatterplot
horvath_control_scatterplot <- ggplot(data=raw_controls, aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='black', fill='darkgrey') +
labs(title =paste0("Full lifespan: N = ", nrow(raw_controls)));
horvath_control_scatterplot
horvath_control_scatterplot <- ggplot(data=raw_controls, aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='black', fill='darkgrey') +
labs(title =paste0("Full lifespan control: N = ", nrow(raw_controls)));
horvath_control_scatterplot
horvath_control_scatterplot_half <- ggplot(data=raw_controls[raw_controls$Age_years <= 55,], aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='black', fill='darkgrey') +
labs(title =paste0("0-55 years control: N = ", nrow(raw_controls[raw_controls$Age_years <= 55,])));
horvath_control_scatterplot_half
raw_controls
lm_formula_ext_int <- paste0('DNAmAge_noob~Age_years+Sex+', paste(colnames(raw_controls)[grep('PC',colnames(raw_controls))], collapse='+'));
lm_formula_int <- paste0('DNAmAge_noob~Age_years+Sex+Gran+CD4T+CD8T+B+Mono+NK+', paste(colnames(raw_controls)[grep('PC',colnames(raw_controls))], collapse='+'));
lm_control_ext_int <- lm(lm_formula_ext_int, data=raw_controls);
lm_control_int <- lm(lm_formula_int, data=raw_controls);
raw_controls$delta_ext_int <- lm_control_ext_int$residuals;
raw_controls$delta_int <- lm_control_int$residuals;
median(abs(raw_controls$delta_ext_int))
cor(raw_controls$Age_years, raw_controls$DNAmAge_noob, method="spearman"); # 0.1984988
cor.test(raw_controls$Age_years, raw_controls$DNAmAge_noob, method="spearman")$p.value; # 3.82813e-21
median(abs(raw_controls$delta_ext_int))
median(abs(raw_controls$delta_int));
cor(raw_controls$Age_years, raw_controls$DNAmAge_noob, method="pearson"); # SCC: 0.9486068
horvath_control_scatterplot <- ggplot(data=raw_controls, aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='black', fill='darkgrey') +
geom_smooth(data=raw_controls[raw_controls$Age_years <= 55,], aes(x=Age_years, y=DNAmAge_noob),
method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='green', fill='darkgrey') +
labs(title =paste0("Full lifespan control: N = ", nrow(raw_controls)));
horvath_control_scatterplot
horvath_control_scatterplot <- ggplot(data=raw_controls, aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='salmon4', fill='darkgrey') +
geom_smooth(data=raw_controls[raw_controls$Age_years <= 55,], aes(x=Age_years, y=DNAmAge_noob),
method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='seagreen', fill='darkgrey') +
labs(title =paste0("Full lifespan control: N = ", nrow(raw_controls)));
horvath_control_scatterplot
horvath_control_scatterplot <- ggplot(data=raw_controls, aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='salmon4', fill='darkgrey') +
geom_smooth(data=raw_controls[raw_controls$Age_years <= 55,], aes(x=Age_years, y=DNAmAge_noob),
method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='seagreen', fill='darkgrey') +
scale_colour_manual(name="Model", values = c("Full lifespan" = "salmon4", "0-55 years" = "seagreen")) +
scale_linetype_manual(name="Model", values = c("Full lifespan" = "solid", "0-55 years" = "solid")) +
labs(title =paste0("Full lifespan control: N = ", nrow(raw_controls)));
horvath_control_scatterplot
horvath_control_scatterplot <- ggplot(data=raw_controls, aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, aes(col='salmon4'), fill='darkgrey') +
geom_smooth(data=raw_controls[raw_controls$Age_years <= 55,], aes(x=Age_years, y=DNAmAge_noob, col='seagreen'),
method="lm", formula=y~x, show.legend=F, alpha = 0.3, fill='darkgrey') +
scale_colour_manual(name="Model", values = c("Full lifespan" = "salmon4", "0-55 years" = "seagreen")) +
scale_linetype_manual(name="Model", values = c("Full lifespan" = "solid", "0-55 years" = "solid")) +
labs(title =paste0("Full lifespan control: N = ", nrow(raw_controls)));
horvath_control_scatterplot
horvath_control_scatterplot <- ggplot(data=raw_controls, aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='salmon4', fill='darkgrey') +
geom_smooth(data=raw_controls[raw_controls$Age_years <= 55,], aes(x=Age_years, y=DNAmAge_noob),
method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='seagreen', fill='darkgrey');
horvath_control_scatterplot
raw_controls$Age_group <- ifelse(raw_controls$Age_years <= 20, 'Young age', ifelse(
raw_controls$Age_years <= 55, 'Middle age', 'Old age'));
boxplot(raw_controls$delta_int, by='Age_group')
boxplot(raw_controls$delta_int, by=raw_controls$Age_group)
raw_controls$Age_group <- ifelse(raw_controls$Age_years <= 20, 'Young age', ifelse(
raw_controls$Age_years <= 55, 'Middle age', 'Old age'));
View(raw_controls)
horvath_control_scatterplot <- ggplot(data=raw_controls, aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='salmon4', fill='darkgrey') +
labs(title =paste0("Full lifespan control: N = ", nrow(raw_controls)));
horvath_control_scatterplot
full_lifespan_df <- data.frame(Age_group=rep(raw_controls$Age_group, 2),
delta=c(raw_controls$delta_ext_int, raw_controls$delta_int),
Model=rep(c("Without CCC", "With CCC"), each=nrow(raw_controls)));
head(full_lifespan_df)
tail(full_lifespan_df)
full_lifespan_bias <- ggplot(data=raw_controls, aes(x=Age_group, y=delta, fill=Model)) +
geom_boxplot()
full_lifespan_bias
full_lifespan_bias <- ggplot(data=full_lifespan_df, aes(x=Age_group, y=delta, fill=Model)) +
geom_boxplot()
full_lifespan_bias
raw_controls$Age_years>55
sum(raw_controls$Age_years>55)
1090/nrow(raw_controls)
summary(lm_control_ext_int)
full_lifespan_df <- data.frame(Age_group=rep(raw_controls$Age_group, 2),
delta=c(raw_controls$delta_ext_int, raw_controls$delta_int),
Model=rep(c("Without CCC", "With CCC"), each=nrow(raw_controls)));
full_lifespan_bias <- ggplot(data=full_lifespan_df, aes(x=Age_group, y=delta, fill=Model)) +
geom_boxplot()
full_lifespan_bias
table(raw_controls$Age_group)
full_lifespan_bias <- ggplot(data=full_lifespan_df, aes(x=Age_group, y=delta, fill=Model)) +
geom_boxplot() + scale_fill_manual(values=c('red', 'blue')) +
theme_classic() +
scale_y_continuous(breaks=seq(-40,40,10)) +
scale_x_discrete(position = "top") +
theme(axis.text=element_text(size=12),
axis.text.x=element_blank(),
axis.title=element_text(size=14,face="bold")) +
xlab("Age group") + ylab("Epigenetic age acceleration (years)") +
guides(fill=guide_legend(title="EAA model")) +
geom_abline(slope=0, intercept=0, linetype=2, size=0.25);
full_lifespan_bias
full_lifespan_bias <- ggplot(data=full_lifespan_df, aes(x=Age_group, y=delta, fill=Model)) +
geom_boxplot() + scale_fill_manual(values=c('red', 'blue')) +
theme_classic() +
scale_y_continuous(breaks=seq(-40,40,10)) +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold")) +
xlab("Age group") + ylab("Epigenetic age acceleration (years)") +
guides(fill=guide_legend(title="EAA model")) +
geom_abline(slope=0, intercept=0, linetype=2, size=0.25);
#ggsave("plots/plot_overall_EEA.pdf", height=5, width=5);
full_lifespan_bias
full_lifespan_df <- data.frame(Age_group=as.factor(rep(raw_controls$Age_group, 2), levels=c('Young age', 'Middle age', 'Old age')),
delta=c(raw_controls$delta_ext_int, raw_controls$delta_int),
Model=rep(c("Without CCC", "With CCC"), each=nrow(raw_controls)));
full_lifespan_bias <- ggplot(data=full_lifespan_df, aes(x=Age_group, y=delta, fill=Model)) +
geom_boxplot() + scale_fill_manual(values=c('red', 'blue')) +
theme_classic() +
scale_y_continuous(breaks=seq(-40,40,10)) +
theme(axis.text=element_text(size=12),
axis.text.x=element_text(angle = -90, hjust = 0, size=12),
axis.title=element_text(size=14,face="bold")) +
xlab("Age group") + ylab("Epigenetic age acceleration (years)") +
guides(fill=guide_legend(title="EAA model")) +
geom_abline(slope=0, intercept=0, linetype=2, size=0.25);
#ggsave("plots/plot_overall_EEA.pdf", height=5, width=5);
full_lifespan_bias
full_lifespan_df$Age_group
as.factor(rep(raw_controls$Age_group, 2), levels=c('Young age', 'Middle age', 'Old age'))
full_lifespan_df <- data.frame(Age_group=factor(rep(raw_controls$Age_group, 2), levels=c('Young age', 'Middle age', 'Old age')),
delta=c(raw_controls$delta_ext_int, raw_controls$delta_int),
Model=rep(c("Without CCC", "With CCC"), each=nrow(raw_controls)));
full_lifespan_df$Age_group
full_lifespan_df <- data.frame(Age_group=factor(rep(raw_controls$Age_group, 2), levels=c('Young age', 'Middle age', 'Old age')),
delta=c(raw_controls$delta_ext_int, raw_controls$delta_int),
Model=rep(c("Without CCC", "With CCC"), each=nrow(raw_controls)));
full_lifespan_bias <- ggplot(data=full_lifespan_df, aes(x=Age_group, y=delta, fill=Model)) +
geom_boxplot() + scale_fill_manual(values=c('red', 'blue')) +
theme_classic() +
scale_y_continuous(breaks=seq(-40,40,10)) +
theme(axis.text=element_text(size=12),
axis.text.x=element_text(angle = -90, hjust = 0, size=12),
axis.title=element_text(size=14,face="bold")) +
xlab("Age group") + ylab("Epigenetic age acceleration (years)") +
guides(fill=guide_legend(title="EAA model")) +
geom_abline(slope=0, intercept=0, linetype=2, size=0.25);
full_lifespan_bias
full_lifespan_bias <- ggplot(data=full_lifespan_df, aes(x=Age_group, y=delta, fill=Model)) +
geom_boxplot() + scale_fill_manual(values=c('red', 'blue')) +
theme_classic() +
scale_y_continuous(breaks=seq(-40,40,10)) +
theme(axis.text=element_text(size=12),
axis.text.x=element_text(angle = -90, hjust = 0, size=12),
axis.title=element_text(size=14,face="bold")) +
xlab("Age group") + ylab("Epigenetic age acceleration (years)") +
guides(fill=guide_legend(title="EAA model")) +
geom_abline(slope=0, intercept=0, linetype=2, size=0.25) +
labs(title =paste0("Full lifespan control: N = ", nrow(raw_controls)));
#ggsave("plots/plot_overall_EEA.pdf", height=5, width=5);
full_lifespan_bias
full_lifespan_bias <- ggplot(data=full_lifespan_df, aes(x=Age_group, y=delta, fill=Model)) +
geom_boxplot() + scale_fill_manual(values=c('red', 'blue')) +
theme_classic() +
scale_y_continuous(breaks=seq(-40,40,10)) +
theme(axis.text=element_text(size=12),
axis.text.x=element_text(angle = -90, hjust = 0, size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5)) +
xlab("Age group") + ylab("Epigenetic age acceleration (years)") +
guides(fill=guide_legend(title="EAA model")) +
geom_abline(slope=0, intercept=0, linetype=2, size=0.25) +
labs(title =paste0("Full lifespan control: N = ", nrow(raw_controls)));
#ggsave("plots/plot_overall_EEA.pdf", height=5, width=5);
full_lifespan_bias
raw_controls <- as.data.frame(fread('final_control_data.tsv'));
controls_reduced <- raw_controls[raw_controls$Age_years <= 55,];
lm_control_ext_int_r <- lm(lm_formula_ext_int, data=controls_reduced);
lm_control_int_r <- lm(lm_formula_int, data=controls_reduced);
summary(lm_control_ext_int_r)
summary(lm_control_int_r)
controls_reduced$delta_ext_int <- lm_control_ext_int_r$residuals;
controls_reduced$delta_int <- lm_control_int_r$residuals;
controls_reduced$Age_group <- ifelse(controls_reduced$Age_years <= 20, 'Young age', 'Middle age');
cor(controls_reduced$Age_years, controls_reduced$DNAmAge_noob, method="pearson"); # PCC: 0.9671172
median(abs(controls_reduced$delta_ext_int)); # MAE without CCC: 2.821098
median(abs(controls_reduced$delta_int)); # MAE with CCC: 2.711711
## Fit linear models for 0-55 years model
raw_controls <- as.data.frame(fread('final_control_data.tsv'));
controls_reduced <- raw_controls[raw_controls$Age_years <= 55,]; # N=1128
lm_control_ext_int_r <- lm(lm_formula_ext_int, data=controls_reduced);
lm_control_int_r <- lm(lm_formula_int, data=controls_reduced);
controls_reduced$delta_ext_int <- lm_control_ext_int_r$residuals;
controls_reduced$delta_int <- lm_control_int_r$residuals;
controls_reduced$Age_group <- ifelse(controls_reduced$Age_years <= 20, 'Young age', 'Middle age');
cor(controls_reduced$Age_years, controls_reduced$DNAmAge_noob, method="pearson"); # PCC: 0.96427
median(abs(controls_reduced$delta_ext_int)); # MAE without CCC: 2.323729
median(abs(controls_reduced$delta_int)); # MAE with CCC: 2.274239
setwd('/Users/dem44/Documents/Thesis/PhD-Thesis/additional_code/Chapter2/');
library(data.table);
library(ggplot2);
library(flexmix);
library(RColorBrewer);
library(gridExtra);
library(cowplot);
library(IlluminaHumanMethylation450kanno.ilmn12.hg19);
library(ggthemes);
#### 1. Basic description of the control dataset. ####
raw_controls <- as.data.frame(fread('final_control_data.tsv'));
#### 5. Horvath's epigenetic clock results. ####
## Fit linear models for full lifespan model
lm_formula_ext_int <- paste0('DNAmAge_noob~Age_years+Sex+', paste(colnames(raw_controls)[grep('PC',colnames(raw_controls))], collapse='+'));
lm_formula_int <- paste0('DNAmAge_noob~Age_years+Sex+Gran+CD4T+CD8T+B+Mono+NK+', paste(colnames(raw_controls)[grep('PC',colnames(raw_controls))], collapse='+'));
lm_control_ext_int <- lm(lm_formula_ext_int, data=raw_controls);
lm_control_int <- lm(lm_formula_int, data=raw_controls);
raw_controls$delta_ext_int <- lm_control_ext_int$residuals;
raw_controls$delta_int <- lm_control_int$residuals;
raw_controls$Age_group <- ifelse(raw_controls$Age_years <= 20, 'Young age', ifelse(
raw_controls$Age_years <= 55, 'Middle age', 'Old age'));
cor(raw_controls$Age_years, raw_controls$DNAmAge_noob, method="pearson"); # PCC: 0.9671172
median(abs(raw_controls$delta_ext_int)); # MAE without CCC: 2.821098
median(abs(raw_controls$delta_int)); # MAE with CCC: 2.711711
## Plots for full lifespan model
horvath_control_scatterplot <- ggplot(data=raw_controls, aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='salmon4', fill='darkgrey') +
labs(title =paste0("Full lifespan control: N = ", nrow(raw_controls)));
ggsave("plots/horvath_control_scatterplot_full_lifespan.pdf", height=5, width=5);
full_lifespan_df <- data.frame(Age_group=factor(rep(raw_controls$Age_group, 2), levels=c('Young age', 'Middle age', 'Old age')),
delta=c(raw_controls$delta_ext_int, raw_controls$delta_int),
Model=rep(c("Without CCC", "With CCC"), each=nrow(raw_controls)));
full_lifespan_bias <- ggplot(data=full_lifespan_df, aes(x=Age_group, y=delta, fill=Model)) +
geom_boxplot() + scale_fill_manual(values=c('red', 'blue')) +
theme_classic() +
scale_y_continuous(breaks=seq(-40,40,10)) +
theme(axis.text=element_text(size=12),
axis.text.x=element_text(angle = -90, hjust = 0, size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5)) +
xlab("Age group") + ylab("Epigenetic age acceleration (years)") +
guides(fill=guide_legend(title="EAA model")) +
geom_abline(slope=0, intercept=0, linetype=2, size=0.25) +
labs(title =paste0("Full lifespan control: N = ", nrow(raw_controls)));
ggsave("plots/horvath_control_bias_full_lifespan.pdf", height=5, width=5);
## Fit linear models for 0-55 years model
raw_controls <- as.data.frame(fread('final_control_data.tsv'));
controls_reduced <- raw_controls[raw_controls$Age_years <= 55,]; # N=1128
lm_control_ext_int_r <- lm(lm_formula_ext_int, data=controls_reduced);
lm_control_int_r <- lm(lm_formula_int, data=controls_reduced);
controls_reduced$delta_ext_int <- lm_control_ext_int_r$residuals;
controls_reduced$delta_int <- lm_control_int_r$residuals;
controls_reduced$Age_group <- ifelse(controls_reduced$Age_years <= 20, 'Young age', 'Middle age');
cor(controls_reduced$Age_years, controls_reduced$DNAmAge_noob, method="pearson"); # PCC: 0.96427
median(abs(controls_reduced$delta_ext_int)); # MAE without CCC: 2.323729
median(abs(controls_reduced$delta_int)); # MAE with CCC: 2.274239
horvath_control_scatterplot_half <- ggplot(data=controls_reduced, aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='seagreen4', fill='darkgrey') +
labs(title =paste0("0-55 years control: N = ", nrow(raw_controls)));
ggsave("plots/horvath_control_scatterplot_0_55.pdf", height=5, width=5);
horvath_control_scatterplot_half <- ggplot(data=controls_reduced, aes(x=Age_years, y=DNAmAge_noob)) +
geom_point(col='grey') +
theme_classic() +
theme(axis.text=element_text(size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
xlab("Chronological age (years)") + ylab("DNAmAge (years)") +
xlim(c(-1,101)) + ylim(c(-1,101)) + geom_abline(slope=1, intercept=0, linetype=2) +
geom_smooth(method="lm", formula=y~x, show.legend=F, alpha = 0.3, col='seagreen4', fill='darkgrey') +
labs(title =paste0("0-55 years control: N = ", nrow(controls_reduced)));
ggsave("plots/horvath_control_scatterplot_0_55.pdf", height=5, width=5);
half_lifespan_df <- data.frame(Age_group=factor(rep(controls_reduced$Age_group, 2), levels=c('Young age', 'Middle age')),
delta=c(controls_reduced$delta_ext_int, controls_reduced$delta_int),
Model=rep(c("Without CCC", "With CCC"), each=nrow(controls_reduced)));
half_lifespan_bias <- ggplot(data=half_lifespan_df, aes(x=Age_group, y=delta, fill=Model)) +
geom_boxplot() + scale_fill_manual(values=c('red', 'blue')) +
theme_classic() +
scale_y_continuous(breaks=seq(-40,40,10)) +
theme(axis.text=element_text(size=12),
axis.text.x=element_text(angle = -90, hjust = 0, size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5)) +
xlab("Age group") + ylab("Epigenetic age acceleration (years)") +
guides(fill=guide_legend(title="EAA model")) +
geom_abline(slope=0, intercept=0, linetype=2, size=0.25) +
labs(title =paste0("0-55 years control: N = ", nrow(half_lifespan_df)));
ggsave("plots/horvath_control_bias_0_55.pdf", height=5, width=5);
half_lifespan_df <- data.frame(Age_group=factor(rep(controls_reduced$Age_group, 2), levels=c('Young age', 'Middle age')),
delta=c(controls_reduced$delta_ext_int, controls_reduced$delta_int),
Model=rep(c("Without CCC", "With CCC"), each=nrow(controls_reduced)));
half_lifespan_bias <- ggplot(data=half_lifespan_df, aes(x=Age_group, y=delta, fill=Model)) +
geom_boxplot() + scale_fill_manual(values=c('red', 'blue')) +
theme_classic() +
scale_y_continuous(breaks=seq(-40,40,10)) +
theme(axis.text=element_text(size=12),
axis.text.x=element_text(angle = -90, hjust = 0, size=12),
axis.title=element_text(size=14,face="bold"),
plot.title = element_text(hjust = 0.5)) +
xlab("Age group") + ylab("Epigenetic age acceleration (years)") +
guides(fill=guide_legend(title="EAA model")) +
geom_abline(slope=0, intercept=0, linetype=2, size=0.25) +
labs(title =paste0("0-55 years control: N = ", nrow(controls_reduced)));
ggsave("plots/horvath_control_bias_0_55.pdf", height=5, width=5);
6+9+15+7
6+9+20+7
